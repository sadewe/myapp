<!DOCTYPE html>
    <head>
    <title>Shake it!</title>
    
	<script src="js/zepto.min.js" type="text/javascript"></script>
	<script src="cordova.js" type="text/javascript"></script>
	<script src="js/shake.js" type="text/javascript"></script>
	
	<!-- CSS Stylesheet -->
	<link rel="stylesheet" href="styles/styles.css" />
	
    <meta charset='UTF-8'> 
    
    <!-- iOS WebApp Metatags -->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Homescreen Icons für iOS und Android -->
	<link rel="apple-touch-icon-precomposed" href="bilder/icon-ipad.png" sizes="72x72" />
	<link rel="apple-touch-icon-precomposed" href="bilder/icon-iphone-retina.png" sizes="114x114" />
	<link rel="apple-touch-icon-precomposed" href="bilder/icon-ipad-retina.png" sizes="144x144" />
	<link rel="apple-touch-icon-precomposed" href="bilder/icon-iphone.png" />
	
	<script>
	
	var geschuettelt = false;
	
	$(function(){
	
	window.onload = function() {
		window.addEventListener('shake', onShake, false);
		
		// Eventhandler: Shake
		
			function onShake(){
			//Folgender Code wird ausgeführt, wenn eine Schüttelgeste vorliegt.
			if(!geschuettelt) {
				// CSS-Klasse austauschen und Bild einblenden
				$(".flickr-bild").toggleClass('sichtbar');
				$('button').text("Neues Foto machen!").toggleClass("shakeit").removeAttr("disabled");
				geschuettelt = true;
			}
		}
		
	};
	
	// Eventhandler: Button
	$('button').on('click', function() {
		if(geschuettelt) {
			polaroidweg();
		} else {
			neuespolaroid();
		}
	});
		
	});
	
	// Neues Polaroid einblenden 
	var neuespolaroid = function() {
	
		navigator.camera.getPicture(onSuccess, onFail, {
			quality: 10,
			destinationType: Camera.DestinationType.FILE_URI,
			targetWidth:400,
			targetHeight:400
		});

	};
	
	function onSuccess(imageURI){
		
		$(".polaroid-rahmen").css('-webkit-transform', 'rotate('+(Math.floor(Math.random() * 10)-5)+'deg)');
		$('.polaroid-rahmen').toggleClass('sichtbar');
			
		// Text des Buttons ändern, CSS-Klasse hinzufügen und Button deaktivieren
		$('button').text("Und jetzt, shake it!").toggleClass('shakeit'.attr("disabled", "disabled"));

		// Das Bild als Hintergrundbild des Containers festlegen
		$('.kamera-bild').css("background", "url(" + imageURI + ")");

		}
	
	function onFail(message){
		alert("Das Foto konnte aus folgenden Gründen nicht geschossen werden: " + message);
	}
	
	//Altes Polaroid verschwinden lassen
	var polaroidweg = function () {
		
		$(".kamera-bild").toggleClass('sichtbar');
		$(".polaroid-rahmen").toggleClass('sichtbar');
		
		$(".polaroid-rahmen").css('-webkit-transform', 'rotate('+(Math.floor(Math.random() * 180)-90)+'deg)');
		
		geschuettelt = false;
		
		setTimeout(function() {
			neuespolaroid();
		}, 1000);
	};
	
	</script>

</head>
<body> 
	<!-- Polaroid-->
	<div class="polaroid-rahmen">
		<div class="kamera-bild"></div>
	</div>
	
	<footer>
		<button>Foto machen!</button>
	</footer>

</body>
</html>